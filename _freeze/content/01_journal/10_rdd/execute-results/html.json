{
  "hash": "7dcf7055c9baeebc28a366fb398a2a00",
  "result": {
    "markdown": "---\ntitle: \"Regression Discontinuity\"\n---\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-1_652da44a7345deb604b9a51961be6f27'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(rddensity)\n\ndf<- readRDS(\"../../assignment_data/coupon.rds\")\n\n# Define cut-off\nc0 <- 60\n\n# Density test\nrddd <- rddensity(df$days_since_last, c = c0)\nsummary(rddd)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Manipulation testing using local polynomial density estimation.\n#> \n#> Number of obs =       5000\n#> Model =               unrestricted\n#> Kernel =              triangular\n#> BW method =           estimated\n#> VCE method =          jackknife\n#> \n#> c = 60                Left of c           Right of c          \n#> Number of obs         3854                1146                \n#> Eff. Number of obs    1486                734                 \n#> Order est. (p)        2                   2                   \n#> Order bias (q)        3                   3                   \n#> BW est. (h)           31.203              31.915              \n#> \n#> Method                T                   P > |T|             \n#> Robust                1.1559              0.2477\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning in summary.CJMrddensity(rddd): There are repeated observations. Point\n#> estimates and standard errors have been adjusted. Use option massPoints=FALSE\n#> to suppress this feature.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> P-values of binomial tests (H0: p=0.5).\n#> \n#> Window Length / 2          <c     >=c    P>|T|\n#> 0.500                      20      20    1.0000\n#> 1.000                      31      35    0.7122\n#> 1.500                      44      47    0.8341\n#> 2.000                      70      68    0.9322\n#> 2.500                      92      89    0.8819\n#> 3.000                     110     105    0.7851\n#> 3.500                     123     118    0.7967\n#> 4.000                     135     129    0.7584\n#> 4.500                     148     142    0.7691\n#> 5.000                     164     159    0.8239\n```\n:::\n:::\n\n# . Half the bandwidth:\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-2_21561643a83f033cfd75f185ce7b86fb'}\n\n```{.r .cell-code}\n# Specify bandwidth\nbw_half <- c0 + c(-5/2, 5/2)\n\n# Subsets below and above threshold in specified bandwidth\ndf_bw_below <- df %>% filter(days_since_last >= bw_half[1] & days_since_last < c0)\ndf_bw_above <- df %>% filter(days_since_last >= c0 & days_since_last <= bw_half[2])\n\n\ndf_bw_half <- bind_rows(df_bw_above, df_bw_below)\ndim(df_bw_half)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 181   4\n```\n:::\n\n```{.r .cell-code}\n# [3.2] Local Average treatment effect (LATE) ----\n# Extract values for vertical lines to visualize local average treatment effect\nmodel_bw_below <- lm(purchase_after ~ days_since_last, df_bw_below)\nmodel_bw_above <- lm(purchase_after ~ days_since_last, df_bw_above)\n\ny0 <- predict(model_bw_below, tibble(days_since_last = c0))\ny1 <- predict(model_bw_above, tibble(days_since_last = c0))\n\nlate <- y1 - y0\nsprintf(\"LATE: %.2f\", late)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] \"LATE: 7.36\"\n```\n:::\n\n```{.r .cell-code}\n# [4] Estimation ----\n# [4.1] Parametric ----\n# Compute coefficients for specified bandwidth.\nlm_bw_half <- lm(purchase_after ~ days_since_last_centered + coupon, df_bw_half)\nsummary(lm_bw_half)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = purchase_after ~ days_since_last_centered + coupon, \n#>     data = df_bw_half)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -10.9680  -2.2013   0.1676   2.1516   8.2567 \n#> \n#> Coefficients:\n#>                          Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)               11.6612     0.5747  20.292  < 2e-16 ***\n#> days_since_last_centered   0.6883     0.3219   2.138   0.0339 *  \n#> couponTRUE                 7.1679     1.0172   7.047 3.87e-11 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 3.289 on 178 degrees of freedom\n#> Multiple R-squared:  0.6622,\tAdjusted R-squared:  0.6584 \n#> F-statistic: 174.5 on 2 and 178 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n# . double the bandwidth\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-3_9d9bf1e6e10f9bf67a24d4f399675d68'}\n\n```{.r .cell-code}\n# doubled bw\nbw_doubled <- c0 + c(-10, 10)\n\n# Subsets below and above threshold in specified bandwidth\ndf_bw_below <- df %>% filter(days_since_last >= bw_doubled[1] & days_since_last < c0)\ndf_bw_above <- df %>% filter(days_since_last >= c0 & days_since_last <= bw_doubled[2])\n\ndf_bw_doubled <- bind_rows(df_bw_above, df_bw_below)\ndim(df_bw_doubled)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 629   4\n```\n:::\n\n```{.r .cell-code}\n# [3.2] Local Average treatment effect (LATE) ----\n# Extract values for vertical lines to visualize local average treatment effect\nmodel_bw_below <- lm(purchase_after ~ days_since_last, df_bw_below)\nmodel_bw_above <- lm(purchase_after ~ days_since_last, df_bw_above)\n\ny0 <- predict(model_bw_below, tibble(days_since_last = c0))\ny1 <- predict(model_bw_above, tibble(days_since_last = c0))\n\nlate <- y1 - y0\nsprintf(\"LATE: %.2f\", late)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] \"LATE: 9.51\"\n```\n:::\n\n```{.r .cell-code}\n# [4] Estimation ----\n# [4.1] Parametric ----\n# Compute coefficients for specified bandwidth.\nlm_bw_doubled <- lm(purchase_after ~ days_since_last_centered + coupon, df_bw_doubled)\nsummary(lm_bw_doubled)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = purchase_after ~ days_since_last_centered + coupon, \n#>     data = df_bw_doubled)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -12.2718  -2.0858  -0.0003   2.0275  10.6749 \n#> \n#> Coefficients:\n#>                          Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)              10.61700    0.27386  38.767   <2e-16 ***\n#> days_since_last_centered  0.01413    0.04255   0.332     0.74    \n#> couponTRUE                9.51584    0.48628  19.569   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 3.115 on 626 degrees of freedom\n#> Multiple R-squared:  0.7052,\tAdjusted R-squared:  0.7042 \n#> F-statistic: 748.6 on 2 and 626 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n\n\nBy taking half the bandwidth the number of data reduced to 181 and by doubling it, the number nearly doubled as well. The LATE and estimate value has decreased with the decreasing bandwidth and increased with the doubled bandwidth. The p-value of couponTRUE however has increased only for the smaller bandwidth.\n\n\n# . Free Shipping\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-4_0c0f96dd942c7054ad675c76836ea3a5'}\n\n```{.r .cell-code}\nfree_shipping<- readRDS(\"../../assignment_data/shipping.rds\")\n\nlibrary(ggplot2)\n\n# Create a histogram\nggplot(free_shipping, aes(x = purchase_amount)) +\n  geom_histogram(binwidth = 4, fill = \"skyblue\", color = \"black\", alpha = 0.7) +\n  geom_vline(xintercept = 30, linetype = \"dashed\", color = \"red\", linewidth = 0.5) +\n  labs(title = \"Distribution of Purchase Amounts\",\n       x = \"Purchase Amount (€)\",\n       y = \"Frequency\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](10_rdd_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# density check:\nrd_shipping <- rddensity(free_shipping$purchase_amount, c = 30)\nsummary(rd_shipping)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Manipulation testing using local polynomial density estimation.\n#> \n#> Number of obs =       6666\n#> Model =               unrestricted\n#> Kernel =              triangular\n#> BW method =           estimated\n#> VCE method =          jackknife\n#> \n#> c = 30                Left of c           Right of c          \n#> Number of obs         3088                3578                \n#> Eff. Number of obs    2221                1955                \n#> Order est. (p)        2                   2                   \n#> Order bias (q)        3                   3                   \n#> BW est. (h)           22.909              20.394              \n#> \n#> Method                T                   P > |T|             \n#> Robust                5.9855              0\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning in summary.CJMrddensity(rd_shipping): There are repeated observations.\n#> Point estimates and standard errors have been adjusted. Use option\n#> massPoints=FALSE to suppress this feature.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> P-values of binomial tests (H0: p=0.5).\n#> \n#> Window Length / 2          <c     >=c    P>|T|\n#> 0.261                      20      26    0.4614\n#> 0.522                      41      65    0.0250\n#> 0.783                      62     107    0.0007\n#> 1.043                      81     136    0.0002\n#> 1.304                     100     169    0.0000\n#> 1.565                     114     196    0.0000\n#> 1.826                     132     227    0.0000\n#> 2.087                     156     263    0.0000\n#> 2.348                     173     298    0.0000\n#> 2.609                     191     331    0.0000\n```\n:::\n\n```{.r .cell-code}\n# Visually check continuity at running variable\nrd_shipping_plot <- rdplotdensity(rd_shipping, free_shipping$purchase_amount, plotN = 100)\n```\n\n::: {.cell-output-display}\n![](10_rdd_files/figure-html/unnamed-chunk-4-2.png){width=672}\n:::\n:::\n\nThe histogram shows the sudden change in frequency at 30€. To check it more thoroughly, `rddensity` is used. It shows that the p-value is zero. Additionally, the `rdplotdensity` shows that there is no confidence intervals overlap. This means there is some kind of manipulation around the cut-off and RDD cannot be used to obtain valid results.\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}