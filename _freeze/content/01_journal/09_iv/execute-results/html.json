{
  "hash": "26054e953c65633b33ddc24ae7583d0d",
  "result": {
    "markdown": "---\ntitle: \"Instrumental Variables\"\n---\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-1_216c3c7739ff3bc7075d7a96383f2ecb'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: Paket 'tidyverse' wurde unter R Version 4.3.2 erstellt\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: Paket 'ggplot2' wurde unter R Version 4.3.2 erstellt\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: Paket 'tidyr' wurde unter R Version 4.3.2 erstellt\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: Paket 'purrr' wurde unter R Version 4.3.2 erstellt\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: Paket 'dplyr' wurde unter R Version 4.3.2 erstellt\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: Paket 'forcats' wurde unter R Version 4.3.2 erstellt\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: Paket 'lubridate' wurde unter R Version 4.3.2 erstellt\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n#> ✔ dplyr     1.1.3     ✔ readr     2.1.4\n#> ✔ forcats   1.0.0     ✔ stringr   1.5.0\n#> ✔ ggplot2   3.4.4     ✔ tibble    3.2.1\n#> ✔ lubridate 1.9.3     ✔ tidyr     1.3.0\n#> ✔ purrr     1.0.2     \n#> ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n#> ✖ dplyr::filter() masks stats::filter()\n#> ✖ dplyr::lag()    masks stats::lag()\n#> ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(dagitty)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: Paket 'dagitty' wurde unter R Version 4.3.2 erstellt\n```\n:::\n\n```{.r .cell-code}\nlibrary(ggdag)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: Paket 'ggdag' wurde unter R Version 4.3.2 erstellt\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> \n#> Attache Paket: 'ggdag'\n#> \n#> Das folgende Objekt ist maskiert 'package:stats':\n#> \n#>     filter\n```\n:::\n\n```{.r .cell-code}\nlibrary(MatchIt)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: Paket 'MatchIt' wurde unter R Version 4.3.2 erstellt\n```\n:::\n\n```{.r .cell-code}\nlibrary(dplyr)\n\nrand_enc <- readRDS(\"../../assignment_data/rand_enc.rds\")\n```\n:::\n\n\n# . Draw a DAG of how you understand the relationships.\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-2_dd3b883112496148780a569a9e6dc3ac'}\n\n```{.r .cell-code}\napp_DAG <- dagify(\n  X ~ Z,\n  Y ~ Z,\n  Y ~ X,\n  X ~ IV,\n  coords = list(x = c(IV = 0, Y = 3, Z = 2, X = 1),\n                y = c(IV = 0, Y = 0, Z = 1, X = 0)),\n  labels = list(X = \"New Feature\",\n                Y = \"Time spent\", \n                Z = \"Unknown Confounder\",\n                IV = \"Popup\")\n)\n# Plot DAG\nggdag(app_DAG) +\n  theme_dag_gray() + # custom theme, can be left out\n  geom_dag_point(color = \"lightgreen\") +\n  geom_dag_text(color = \"red\") +\n  geom_dag_edges(edge_color = \"blue\") +\n  geom_dag_label_repel(aes(label = label))\n```\n\n::: {.cell-output-display}\n![](09_iv_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n\n# . Compute the naive, biased estimate.\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-3_179c91fa76ff6c38a7dc375572c3e33f'}\n\n```{.r .cell-code}\nsummary(lm(time_spent ~ used_ftr, data = rand_enc))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = time_spent ~ used_ftr, data = rand_enc)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -20.4950  -3.5393   0.0158   3.5961  20.5051 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept) 18.86993    0.06955   271.3   <2e-16 ***\n#> used_ftr    10.82269    0.10888    99.4   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 5.351 on 9998 degrees of freedom\n#> Multiple R-squared:  0.497,\tAdjusted R-squared:  0.497 \n#> F-statistic:  9881 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n# . \n## .the assumptions that can be (partly) tested, check whether they are satisfied by either computing correlations or drawing plots.\n\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-4_a007418f7ac81d6f8a51a17349e4429a'}\n\n```{.r .cell-code}\n# Correlation matrix\ncor(rand_enc) %>% round(2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>            rand_enc used_ftr time_spent\n#> rand_enc       1.00     0.20       0.13\n#> used_ftr       0.20     1.00       0.71\n#> time_spent     0.13     0.71       1.00\n```\n:::\n:::\n\n**Stable unit treatment value assumption:** \nIt is valid as the use of new feature by one user doesn't affect the other. \\\n\n**Independence assumption: **\nThere is no known confounding variable between Encouragement popup and the use of new feature or between the popup and the time spent.\\\n\n**Exclusion restriction:**\nThe instrument, encouragement popup does not directly affect the outcome time_spent but only through the treatment, the new feature.\\\n\n**Instrument relevance:**\nAs seen from the correlation matrix, the instrument \"rand_enc\" and treatment variable \"used_ftr\" are correlated. However, the correlation is not so strong, only 0.2 \\\n\n**Monotonicity assumption:**\nInstrument and treatment variables are compliers.\\\n\n\n## . Argue whether instrumental variable estimation is an adequate procedure.\nThe necessary assumptions are fulfilled. The correlation between instrument and treatment variable is however not so high. So, it is important to interpret the results with caution and further exploration and potential refinement of the instrumental variable may be beneficial.\n\n\n\n\n# .\n## . Compute the IV estimate using 2SLS and compare it to the naive estimate.\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-5_c60890c29091e10cf6ade0d9904c3bd9'}\n\n```{.r .cell-code}\nlibrary(estimatr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: Paket 'estimatr' wurde unter R Version 4.3.2 erstellt\n```\n:::\n\n```{.r .cell-code}\nmodel_iv <- iv_robust(time_spent ~ used_ftr | rand_enc, data = rand_enc)\nsummary(model_iv)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> iv_robust(formula = time_spent ~ used_ftr | rand_enc, data = rand_enc)\n#> \n#> Standard error type:  HC2 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value  Pr(>|t|) CI Lower CI Upper   DF\n#> (Intercept)   19.312     0.2248   85.89 0.000e+00   18.872    19.75 9998\n#> used_ftr       9.738     0.5353   18.19 8.716e-73    8.689    10.79 9998\n#> \n#> Multiple R-squared:  0.4921 ,\tAdjusted R-squared:  0.492 \n#> F-statistic:   331 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\nThe estimate has reduced by about 1 unit and the p-value has significantly reduced as well.\n\n##. Would you consider the naive estimate biased, and if yes, does it have an upward or downward bias?\nThe difference in estimates suggests that there might be unobserved confounding, and the naive estimate could be biased, potentially with an upward bias like in the given example regarding voluntary training program .\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}